# Story 05.05: Developer Experience and Tooling Optimization

## Status
Draft

## Story
**As a** development team,
**I want** optimized developer experience with enhanced tooling, debugging capabilities, and workflow automation,
**so that** we can maintain high productivity while ensuring code quality and healthcare compliance.

## Acceptance Criteria
1. VSCode workspace is optimized with healthcare-specific extensions and settings
2. Enhanced debugging configurations for monorepo and healthcare scenarios
3. Automated development workflow scripts and shortcuts
4. Code generation templates for healthcare components and patterns
5. Enhanced documentation generation and maintenance automation
6. Development environment standardization across team
7. Performance profiling and optimization tools integration
8. Healthcare-specific development patterns and snippets

## Tasks / Subtasks

- [ ] **Task 1: Optimize VSCode Workspace Configuration** (AC: 1)
  - [ ] Update workspace settings for monorepo structure
  - [ ] Add healthcare-specific VSCode extensions
  - [ ] Configure debugging for Next.js and Supabase
  - [ ] Set up code snippets for healthcare patterns
  - [ ] Configure extension recommendations
  - [ ] Add workspace-specific tasks and launch configs

- [ ] **Task 2: Enhanced Debugging Configurations** (AC: 2)
  - [ ] Configure Next.js debugging for apps/web
  - [ ] Set up Supabase Edge Functions debugging
  - [ ] Add React DevTools integration
  - [ ] Configure database debugging tools
  - [ ] Set up E2E test debugging
  - [ ] Add healthcare data flow debugging

- [ ] **Task 3: Automated Development Workflow Scripts** (AC: 3)
  - [ ] Add `dev:setup` script for new developer onboarding
  - [ ] Create `dev:clean` script for environment cleanup
  - [ ] Add `dev:reset` script for complete workspace reset
  - [ ] Create `dev:health` script for environment health check
  - [ ] Add `dev:update` script for dependency and tool updates
  - [ ] Create `dev:backup` script for local development backup

- [ ] **Task 4: Healthcare Code Generation Templates** (AC: 4)
  - [ ] Create patient form component generator
  - [ ] Add LGPD-compliant API endpoint generator
  - [ ] Create medical procedure component generator
  - [ ] Add database migration generator for healthcare
  - [ ] Create test template generator for healthcare scenarios
  - [ ] Add compliance documentation generator

- [ ] **Task 5: Documentation Generation and Maintenance** (AC: 5)
  - [ ] Set up TypeDoc for API documentation
  - [ ] Configure Storybook for UI component documentation
  - [ ] Add automated README generation
  - [ ] Set up architecture decision record (ADR) templates
  - [ ] Configure automated changelog generation
  - [ ] Add healthcare compliance documentation automation

- [ ] **Task 6: Development Environment Standardization** (AC: 6)
  - [ ] Create `.devcontainer` configuration for consistent environments
  - [ ] Add Docker development environment setup
  - [ ] Configure Node.js version management with .nvmrc
  - [ ] Set up environment variable templates
  - [ ] Add development database seeding scripts
  - [ ] Create team onboarding documentation

- [ ] **Task 7: Performance Profiling Tools Integration** (AC: 7)
  - [ ] Add React DevTools Profiler integration
  - [ ] Configure Bundle Analyzer automation
  - [ ] Set up Lighthouse development integration
  - [ ] Add database query profiling tools
  - [ ] Configure memory usage monitoring
  - [ ] Add performance regression detection

- [ ] **Task 8: Healthcare Development Patterns and Snippets** (AC: 8)
  - [ ] Create LGPD-compliant form snippets
  - [ ] Add patient data handling patterns
  - [ ] Create medical validation snippets
  - [ ] Add ANVISA compliance code patterns
  - [ ] Create CFM regulation snippets
  - [ ] Add accessibility pattern snippets

## Dev Notes

### Previous Story Context
This story focuses on developer experience optimization after implementing CI/CD enhancements and advanced Turborepo features.

### VSCode Workspace Configuration

#### Workspace Settings
```json
// .vscode/settings.json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "typescript.preferences.includePackageJsonAutoImports": "auto",
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "biomejs.biome",
  "editor.codeActionsOnSave": {
    "source.fixAll.biome": true,
    "source.organizeImports.biome": true
  },
  "files.exclude": {
    "**/node_modules": true,
    "**/.turbo": true,
    "**/dist": true,
    "**/.next": true
  },
  "search.exclude": {
    "**/node_modules": true,
    "**/.turbo": true,
    "**/dist": true,
    "**/.next": true
  },
  "emmet.includeLanguages": {
    "typescript": "typescriptreact",
    "javascript": "javascriptreact"
  },
  "tailwindCSS.includeLanguages": {
    "typescript": "typescript",
    "typescriptreact": "typescriptreact"
  },
  "tailwindCSS.experimental.classRegex": [
    ["cva\\(([^)]*)\\)", "[\"'`]([^\"'`]*).*?[\"'`]"],
    ["cx\\(([^)]*)\\)", "(?:'|\"|`)([^']*)(?:'|\"|`)"]
  ]
}
```

#### Extension Recommendations
```json
// .vscode/extensions.json
{
  "recommendations": [
    "biomejs.biome",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-typescript-next",
    "esbenp.prettier-vscode",
    "ms-playwright.playwright",
    "ms-vscode.vscode-json",
    "redhat.vscode-yaml",
    "ms-vscode.vscode-eslint",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense",
    "ms-vscode.vscode-docker",
    "ms-azuretools.vscode-docker"
  ]
}
```

### Debugging Configurations

#### Launch Configuration
```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Next.js: debug server-side",
      "type": "node-terminal",
      "request": "launch",
      "command": "pnpm dev",
      "cwd": "${workspaceFolder}/apps/web",
      "serverReadyAction": {
        "pattern": "ready - started server on .+, url: (https?://.+)",
        "uriFormat": "%s",
        "action": "debugWithChrome"
      }
    },
    {
      "name": "Next.js: debug client-side",
      "type": "chrome",
      "request": "launch",
      "url": "http://localhost:3000",
      "webRoot": "${workspaceFolder}/apps/web"
    },
    {
      "name": "Debug Healthcare E2E Tests",
      "type": "node",
      "request": "launch",
      "program": "${workspaceFolder}/node_modules/.bin/playwright",
      "args": ["test", "--config=tools/testing/playwright.config.ts"],
      "cwd": "${workspaceFolder}",
      "console": "integratedTerminal"
    }
  ]
}
```

### Code Snippets

#### Healthcare Form Snippet
```json
// .vscode/snippets/healthcare.code-snippets
{
  "LGPD Compliant Form": {
    "prefix": "lgpd-form",
    "body": [
      "import { useState } from 'react';",
      "import { useForm } from 'react-hook-form';",
      "import { zodResolver } from '@hookform/resolvers/zod';",
      "import { z } from 'zod';",
      "",
      "const ${1:formName}Schema = z.object({",
      "  // Patient data with LGPD compliance",
      "  patientConsent: z.boolean().refine(val => val === true, {",
      "    message: 'Consent is required for LGPD compliance'",
      "  }),",
      "  $2",
      "});",
      "",
      "type ${1/(.*)/${1:/capitalize}Schema/} = z.infer<typeof ${1:formName}Schema>;",
      "",
      "export function ${1/(.*)/${1:/pascalcase}/}() {",
      "  const form = useForm<${1/(.*)/${1:/capitalize}Schema/}>({",
      "    resolver: zodResolver(${1:formName}Schema),",
      "    defaultValues: {",
      "      patientConsent: false,",
      "      $3",
      "    }",
      "  });",
      "",
      "  const onSubmit = (data: ${1/(.*)/${1:/capitalize}Schema/}) => {",
      "    // LGPD compliant data handling",
      "    console.log('Processing patient data with LGPD compliance:', data);",
      "    $4",
      "  };",
      "",
      "  return (",
      "    <form onSubmit={form.handleSubmit(onSubmit)}>",
      "      {/* LGPD Consent Checkbox */}",
      "      <label>",
      "        <input",
      "          type=\"checkbox\"",
      "          {...form.register('patientConsent')}",
      "        />",
      "        I consent to the processing of my personal data in accordance with LGPD",
      "      </label>",
      "      $5",
      "      <button type=\"submit\">Submit</button>",
      "    </form>",
      "  );",
      "}"
    ],
    "description": "Create LGPD-compliant form component"
  }
}
```

### Development Scripts

#### Enhanced Package.json Scripts
```json
{
  "scripts": {
    // Development Environment
    "dev:setup": "node scripts/dev-setup.js",
    "dev:clean": "turbo clean && pnpm store prune",
    "dev:reset": "npm run dev:clean && pnpm install",
    "dev:health": "node scripts/health-check.js",
    "dev:update": "pnpm update --recursive && turbo build",
    "dev:backup": "node scripts/backup-dev.js",
    
    // Documentation
    "docs:generate": "typedoc && storybook build",
    "docs:serve": "storybook dev -p 6006",
    "docs:api": "typedoc --out docs/api apps/web/src packages/*/src",
    
    // Code Generation
    "gen:healthcare-form": "turbo gen healthcare-form",
    "gen:api-endpoint": "turbo gen api-endpoint",
    "gen:migration": "turbo gen migration",
    
    // Performance
    "perf:profile": "next build --profile",
    "perf:analyze": "ANALYZE=true next build",
    "perf:lighthouse": "lhci autorun --config=.lighthouserc.js"
  }
}
```

### Development Environment Setup

#### Dev Container Configuration
```json
// .devcontainer/devcontainer.json
{
  "name": "NeonPro Healthcare Development",
  "dockerComposeFile": "../docker-compose.dev.yml",
  "service": "app",
  "workspaceFolder": "/workspace",
  "customizations": {
    "vscode": {
      "extensions": [
        "biomejs.biome",
        "bradlc.vscode-tailwindcss",
        "ms-vscode.vscode-typescript-next",
        "ms-playwright.playwright"
      ],
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash",
        "editor.formatOnSave": true
      }
    }
  },
  "postCreateCommand": "pnpm install && pnpm build",
  "postStartCommand": "pnpm dev:health",
  "features": {
    "ghcr.io/devcontainers/features/node:1": {
      "version": "20"
    },
    "ghcr.io/devcontainers/features/docker-in-docker:2": {}
  }
}
```

#### Docker Development Setup
```dockerfile
# .devcontainer/Dockerfile
FROM node:20-alpine

# Install pnpm
RUN npm install -g pnpm

# Install development tools
RUN apk add --no-cache git curl

# Set up workspace
WORKDIR /workspace

# Copy package files
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY apps/web/package.json ./apps/web/
COPY packages/*/package.json ./packages/*/

# Install dependencies
RUN pnpm install --frozen-lockfile

# Install healthcare-specific tools
RUN pnpm add -g @biomejs/biome typescript

# Set up development environment
COPY . .

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD node scripts/health-check.js

EXPOSE 3000
CMD ["pnpm", "dev"]
```

### Code Generation Templates

#### Healthcare API Endpoint Generator
```typescript
// turbo/generators/templates/api-endpoint.hbs
import { NextRequest, NextResponse } from 'next/server';
import { z } from 'zod';
import { createClient } from '@/lib/supabase/server';
import { validateLGPDCompliance } from '@/lib/lgpd';

// LGPD-compliant schema
const {{camelCase name}}Schema = z.object({
  // Add your schema here
});

export async function GET(request: NextRequest) {
  try {
    const supabase = createClient();
    
    // LGPD compliance check
    await validateLGPDCompliance(request);
    
    // Your implementation here
    
    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('{{titleCase name}} API error:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}

export async function POST(request: NextRequest) {
  try {
    const supabase = createClient();
    const body = await request.json();
    
    // Validate input with LGPD compliance
    const validatedData = {{camelCase name}}Schema.parse(body);
    await validateLGPDCompliance(request, validatedData);
    
    // Your implementation here
    
    return NextResponse.json({ success: true });
  } catch (error) {
    console.error('{{titleCase name}} API error:', error);
    return NextResponse.json(
      { error: 'Internal server error' },
      { status: 500 }
    );
  }
}
```

### File Locations
- VSCode configs: `.vscode/`
- Dev container: `.devcontainer/`
- Code snippets: `.vscode/snippets/`
- Generators: `turbo/generators/`
- Scripts: `scripts/`
- Documentation: `docs/`

### Technical Constraints
- Must support monorepo development workflow
- Must integrate with existing Turborepo setup
- Must maintain healthcare compliance during development
- Must provide consistent development experience

### Healthcare-Specific Considerations
- LGPD compliance in all generated code
- Patient data privacy patterns
- ANVISA regulation compliance helpers
- CFM professional standards integration
- Accessibility development patterns

## Testing
### Testing Standards
- All development scripts must work in clean environment
- VSCode configurations must load without errors
- Code generators must produce valid, compliant code
- Documentation generation must be complete and accurate
- Development environment must pass health checks

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-15 | 1.0 | Initial story creation | BMad Master |