# Epic 2.0: NeonPro Turborepo Architecture Refactoring

## Status

Draft

## Epic Overview

**As a** Development Team,
**I want** to refactor the NeonPro project from its current chaotic structure to a clean, efficient Turborepo monorepo,
**So that** we can achieve better code organization, faster builds, improved maintainability, and proper separation of concerns following the architecture defined in docs/architecture.md.

## Epic Goals

1. **Eliminate Code Duplication**: Consolidate scattered code (root src/, lib/, hooks/) into proper locations
2. **Establish Clean Architecture**: Implement proper Turborepo monorepo structure with apps/ and packages/
3. **Improve Build Performance**: Leverage Turborepo caching and parallel builds
4. **Enhance Maintainability**: Clear separation between app-specific and shared code
5. **Enable Scalability**: Proper package structure for future growth

## Current State Analysis

### Problematic Structure (To Be Fixed)
- **Root `src/`**: Duplicates content that should be in `apps/web/`
- **Root `lib/`**: Utilities that should be in `packages/utils/`
- **Root `hooks/`**: Mixed app-specific and shared hooks
- **Root `prisma/`**: Database schema outside proper package structure
- **Root `supabase/`**: Database migrations and config scattered

### Target Architecture
```
neonpro/
├── apps/
│   └── web/                    # Next.js 15 App Router (Main Application)
├── packages/                   # Shared packages for monorepo
│   ├── ui/                    # @neonpro/ui - Shared UI components
│   ├── utils/                 # @neonpro/utils - Shared utilities
│   ├── types/                 # @neonpro/types - Shared TypeScript definitions
│   ├── config/                # @neonpro/config - Shared configurations
│   └── db/                    # @neonpro/db - Database package (NEW)
│       ├── prisma/           # Prisma schema
│       └── supabase/         # Supabase config and migrations
```

## Stories in Epic

### **Phase 1: Database Consolidation**
- [Story 2.1: Database Package Creation](./2.1.database-package-creation.md) - Create unified database package
- [Story 2.2: Supabase Migration Consolidation](./2.2.supabase-migration-consolidation.md) - Move Supabase assets

### **Phase 2: Shared Code Organization**  
- [Story 2.3: Utilities Package Consolidation](./2.3.utilities-package-consolidation.md) - Move root lib/ to packages/utils/
- [Story 2.4: Hooks Distribution](./2.4.hooks-distribution.md) - Distribute hooks to appropriate packages

### **Phase 3: Application Consolidation**
- [Story 2.5: Source Code Consolidation](./2.5.source-code-consolidation.md) - Merge root src/ with apps/web/
- [Story 2.6: Configuration Updates](./2.6.configuration-updates.md) - Update import paths and configs

### **Phase 4: Cleanup & Validation**
- [Story 2.7: Legacy Cleanup](./2.7.legacy-cleanup.md) - Remove redundant files and directories
- [Story 2.8: Build Validation](./2.8.build-validation.md) - Verify complete system functionality

## Success Criteria

1. **Clean Turborepo Structure**: All code properly organized in apps/ and packages/
2. **Zero Code Duplication**: No scattered duplicate functionality
3. **Functional Builds**: All packages build independently and together
4. **Working Imports**: All import paths updated and functional
5. **Performance Gains**: Turborepo caching provides build performance improvements
6. **Documentation Alignment**: Structure matches docs/architecture.md specifications

## Risks and Mitigations

### **High Risk: Breaking Import Paths**
- **Mitigation**: Update imports incrementally, validate at each step
- **Rollback**: Git checkpoints at each story completion

### **Medium Risk: Build Configuration Conflicts**
- **Mitigation**: Update configurations systematically, test builds frequently
- **Rollback**: Maintain backup of working configurations

### **Low Risk: Package Dependency Issues**
- **Mitigation**: Use PNPM workspace references, test package isolation
- **Rollback**: Revert to monolithic structure if needed

## Dependencies

- **Architecture Document**: `docs/architecture.md` defines target structure
- **Current Codebase**: Analysis of existing structure completed
- **Turborepo Knowledge**: Team understanding of Turborepo patterns required

## Completion Timeline

**Estimated Duration**: 2-3 development days
**Stories**: 8 focused stories, each 2-4 hours of work
**Critical Path**: Phase 1 → Phase 2 → Phase 3 → Phase 4 (sequential execution required)

## Quality Gates

- Each story must pass: Build ✅ Tests ✅ Lint ✅ Type Check ✅
- Integration validation after each phase
- Full system validation after epic completion

---

## Change Log

| Date       | Version | Description                      | Author      |
| ---------- | ------- | -------------------------------- | ----------- |
| 2025-08-16 | 1.0     | Epic creation for refactoring   | BMad Master |

## Dev Agent Record

_[To be populated by development agent during implementation]_

## QA Results

_[To be populated by QA agent during review]_