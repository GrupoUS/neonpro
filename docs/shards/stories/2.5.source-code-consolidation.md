# Story 2.5: Source Code Consolidation - Brownfield Addition

## Status

Completed ✅

## Story

**As a** Developer,
**I want** all remaining source code consolidated from root-level src/ and components/ directories into appropriate packages,
**So that** the codebase follows Turborepo monorepo patterns and eliminates root-level duplication.

## Story Context

**Existing System Integration:**

- Integrates with: Current root `src/` and `components/` directories with mixed content
- Technology: React 18, Next.js 15, TypeScript, shadcn/ui components
- Follows pattern: Established packages structure with clear separation of concerns
- Touch points: Page components, shared components, business logic, type definitions

**Current State:**
- Root `src/` contains mixed application and shared code
- Root `components/` has components that should be in packages
- Some duplication between root directories and packages

## Acceptance Criteria

**Functional Requirements:**

1. Migrate all reusable components from root `components/` to `packages/ui/`
2. Move application-specific code from root `src/` to `apps/web/src/`
3. Consolidate shared business logic into appropriate packages

**Integration Requirements:**

4. Existing component imports continue to work via workspace references
5. Application functionality is preserved during migration
6. Integration maintains current component behavior and styling

**Quality Requirements:**

7. All components preserve styling and functionality
8. Component dependencies are properly resolved
9. TypeScript types and props are maintained

## Technical Notes

- **Integration Approach**: Categorize by reusability (app-specific vs shared)
- **Existing Pattern Reference**: Follow established package component organization
- **Key Constraints**: Maintain component functionality and existing page integrations

## Tasks / Subtasks

### Phase 1: Content Analysis and Categorization

- [ ] **Task 1.1: Analyze Root src/ Directory**
  - [ ] Inventory all files in root `src/` directory
  - [ ] Identify application-specific vs shared code
  - [ ] Check for any Next.js specific files (pages, api, middleware)
  - [ ] Catalog business logic vs UI components

- [ ] **Task 1.2: Analyze Root components/ Directory**
  - [ ] Inventory all components in root `components/`
  - [ ] Identify reusable vs page-specific components
  - [ ] Check component dependencies and imports
  - [ ] Categorize by domain (ui, domain, app-specific)

### Phase 2: Component Migration

- [ ] **Task 2.1: Migrate Shared Components to UI Package**
  - [ ] Move reusable components to `packages/ui/src/components/`
  - [ ] Preserve component file structure and organization
  - [ ] Update component exports in UI package
  - [ ] Maintain shadcn/ui integration patterns

- [ ] **Task 2.2: Migrate Page Components to Web App**
  - [ ] Move page-specific components to `apps/web/src/components/`
  - [ ] Preserve component hierarchy and organization
  - [ ] Update component imports within the app
  - [ ] Maintain Next.js integration patterns

### Phase 3: Source Code Migration

- [ ] **Task 3.1: Migrate App-Specific Code**
  - [ ] Move Next.js app code to `apps/web/src/`
  - [ ] Preserve pages, api, and app directory structure
  - [ ] Update middleware and configuration files
  - [ ] Maintain Next.js 15 app router patterns

- [ ] **Task 3.2: Migrate Shared Business Logic**
  - [ ] Move shared business logic to `packages/domain/src/`
  - [ ] Organize by business capability and domain
  - [ ] Update exports and barrel files
  - [ ] Maintain business rule integrity

### Phase 4: Import Path Updates

- [ ] **Task 4.1: Update Component Imports**
  - [ ] Update imports from root components/ to packages
  - [ ] Update imports from root src/ to appropriate packages
  - [ ] Use workspace references for package imports
  - [ ] Verify all imports resolve correctly

- [ ] **Task 4.2: Update Type Imports**
  - [ ] Update type imports to use packages/types
  - [ ] Verify TypeScript compilation
  - [ ] Check for any circular dependencies
  - [ ] Ensure type safety is maintained

## Definition of Done

- [ ] Root `src/` directory content properly distributed
- [ ] Root `components/` directory content migrated to packages
- [ ] Shared components in `packages/ui/src/components/`
- [ ] App-specific code in `apps/web/src/`
- [ ] Business logic in `packages/domain/src/`
- [ ] All imports updated to use workspace references
- [ ] Component functionality and styling preserved
- [ ] TypeScript compilation successful

## Risk and Compatibility Check

**Primary Risk:** Breaking component imports and page functionality
**Mitigation:** Systematic migration with workspace references, thorough testing
**Rollback:** Restore original directory structure using git

**Compatibility Verification:**

- [ ] No breaking changes to component APIs
- [ ] All page components render correctly
- [ ] Shared components work across applications
- [ ] Next.js routing and middleware function properly
- [ ] shadcn/ui integration remains intact

## Content Categorization

**Shared Components (packages/ui/):**
- Reusable UI components
- Design system components
- Common form components
- Layout components

**App-Specific Components (apps/web/):**
- Page-specific components
- Application layout components
- Route-specific UI elements
- App-specific business components

**Business Logic (packages/domain/):**
- Healthcare business rules
- Data processing logic
- API integration logic
- Compliance and validation logic

**Type Definitions (packages/types/):**
- Shared interface definitions
- API response types
- Business entity types
- Component prop types

## Dependencies

- **Prerequisite**: Database, utilities, and hooks migration from previous stories
- **Blocks**: Required before configuration updates in Story 2.6
- **Technology**: React 18, Next.js 15, TypeScript, shadcn/ui

## File Structure Result

```
apps/web/src/
├── app/                  # Next.js app router
├── pages/               # Next.js pages (if applicable)
├── components/          # App-specific components
└── lib/                # App-specific utilities

packages/ui/src/components/
├── forms/              # Shared form components
├── layout/             # Layout components
├── navigation/         # Navigation components
└── index.ts           # Component exports

packages/domain/src/
├── healthcare/         # Healthcare business logic
├── compliance/         # Compliance logic
├── api/               # API integration
└── index.ts           # Domain exports
```

---

## Change Log

| Date       | Version | Description                       | Author      |
| ---------- | ------- | --------------------------------- | ----------- |
| 2025-08-16 | 1.0     | Source code consolidation story   | BMad Master |

## Dev Agent Record

_[To be populated by development agent during implementation]_

## QA Results

_[To be populated by QA agent during review]_