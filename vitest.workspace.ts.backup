/**
 * Vitest Workspace Configuration for NeonPro Monorepo
 * Consolidates multiple Vitest configurations into a single workspace
 * Resolves VS Code extension conflicts and improves performance
 */

import { defineWorkspace } from 'vitest/config'

export default defineWorkspace([
  // Main application tests (root level)
  {
    test: {
      name: 'neonpro-main',
      environment: 'jsdom',
      setupFiles: ['./vitest.setup.ts'],
      globals: true,
      css: true,
      include: [
        'app/**/*.{test,spec}.{ts,tsx}',
        'lib/**/*.{test,spec}.{ts,tsx}',
        'components/**/*.{test,spec}.{ts,tsx}',
        'hooks/**/*.{test,spec}.{ts,tsx}',
        '__tests__/**/*.{test,spec}.{ts,tsx}',
      ],
      exclude: [
        'node_modules/',
        'dist/',
        'build/',
        '.next/',
        'coverage/',
        'tools/**',
        'packages/**',
        'apps/**',
        '**/*.config.*',
        '**/*.d.ts',
        '**/playwright/**',
        '**/e2e/**',
        '**/*.removed',
      ],
      pool: 'forks',
      poolOptions: {
        forks: {
          singleFork: true,
        },
      },
      coverage: {
        provider: 'v8',
        reporter: ['text', 'json', 'html'],
        reportsDirectory: './coverage/main',
        include: [
          'app/**/*.{ts,tsx}',
          'lib/**/*.{ts,tsx}',
          'components/**/*.{ts,tsx}',
          'hooks/**/*.{ts,tsx}',
        ],
        exclude: [
          'node_modules/',
          'tools/',
          'coverage/',
          '**/*.d.ts',
          '**/*.config.*',
          '**/*.test.*',
          '**/*.spec.*',
          '**/*.removed',
        ],
      },
    },
  },

  // UI Package - inline configuration to avoid extends issues
  {
    test: {
      name: 'ui-package',
      environment: 'jsdom',
      setupFiles: ['./packages/ui/vitest.setup.ts'],
      globals: true,
      include: [
        'packages/ui/src/**/*.{test,spec}.{ts,tsx}',
        'packages/ui/src/**/__tests__/**/*.{ts,tsx}',
      ],
      exclude: [
        'node_modules/',
        'packages/ui/dist/',
        'packages/ui/build/',
        '**/*.stories.*',
        '**/*.d.ts',
      ],
      coverage: {
        provider: 'v8',
        reporter: ['text', 'lcov'],
        include: ['packages/ui/src/**/*.{ts,tsx}'],
        exclude: [
          'packages/ui/src/**/*.d.ts',
          'packages/ui/src/**/*.stories.*',
          'packages/ui/src/**/index.ts',
        ],
      },
    },
  },

  // Testing suite - inline configuration to avoid extends issues
  {
    test: {
      name: 'testing-suite',
      environment: 'jsdom',
      setupFiles: ['./tools/testing/unit/setup.ts'],
      include: [
        'tools/testing/unit/**/*.{test,spec}.{ts,tsx}',
      ],
      exclude: [
        '**/node_modules/**',
        'tools/testing/e2e/**',
        'tools/testing/playwright/**',
      ],
      globals: true,
      pool: 'threads',
    },
  },
])