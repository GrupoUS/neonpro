openapi: 3.0.3
info:
  title: NeonPro Financial Dashboard API
  description: |
    API for enhanced financial dashboard with interactive visualization and comprehensive financial metrics.
    
    ## Security Requirements
    - All communication MUST use HTTPS with TLS 1.3 or higher
    - HTTP requests are automatically redirected to HTTPS
    - HSTS headers enforced with max-age ≥ 31536000
    - Comprehensive security headers implemented
    - Mixed content strictly prohibited
    
    ## TLS Configuration
    - TLS 1.3 minimum version
    - Perfect Forward Secrecy (PFS) cipher suites
    - Certificate Transparency logging enabled
    - Automatic certificate renewal
    
    ## Performance Requirements
    - Financial metrics loading ≤ 2 seconds
    - Chart interactions ≤ 500ms
    - HTTPS handshake time ≤ 300ms
    - Real-time updates ≤ 1 second latency
    
    ## LGPD Compliance
    - AES-256 encryption for all financial data
    - Role-based access control enforced
    - Audit trails for all data access
    - Consent management integrated
  version: 1.0.0

servers:
  - url: https://api.neonpro.com/v1
    description: Production server (HTTPS required, TLS 1.3+)

security:
  - BearerAuth: []
  - BiometricAuth: []

paths:
  /api/financial/metrics:
    get:
      summary: Get financial metrics overview
      description: |
        Retrieve comprehensive financial metrics for the aesthetic clinic dashboard.
        Includes revenue trends, profit margins, and key performance indicators.
      operationId: getFinancialMetrics
      parameters:
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum: [daily, weekly, monthly, quarterly, yearly]
            default: monthly
        - name: startDate
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Financial metrics data
          headers:
            Strict-Transport-Security:
              description: HSTS header enforcing HTTPS
              schema:
                type: string
                example: "max-age=31536000; includeSubDomains; preload"
            X-Content-Type-Options:
              description: Prevents MIME type sniffing
              schema:
                type: string
                example: "nosniff"
            X-Frame-Options:
              description: Prevents clickjacking
              schema:
                type: string
                example: "DENY"
            Content-Security-Policy:
              description: CSP header
              schema:
                type: string
                example: "default-src 'self'; script-src 'self' 'unsafe-inline'"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FinancialMetricsResponse'        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /api/financial/revenue:
    get:
      summary: Get revenue analytics
      description: |
        Retrieve detailed revenue analytics with breakdown by services, procedures,
        and time periods for aesthetic clinic financial management.
      operationId: getRevenueAnalytics
      parameters:
        - name: breakdown
          in: query
          required: false
          schema:
            type: string
            enum: [service, procedure, practitioner, monthly]
            default: service
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum: [7d, 30d, 90d, 1y]
            default: 30d
      responses:
        '200':
          description: Revenue analytics data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RevenueAnalyticsResponse'

  /api/financial/kpis:
    get:
      summary: Get aesthetic clinic KPIs
      description: |
        Retrieve key performance indicators specific to aesthetic clinic operations
        including CLV, room utilization, treatment conversion rates.
      operationId: getClinicKPIs
      responses:
        '200':
          description: Clinic KPI data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClinicKPIsResponse'

  /api/financial/exports:
    post:
      summary: Export financial reports
      description: |
        Generate and export financial reports in various formats for compliance
        and business analysis with LGPD compliance.
      operationId: exportFinancialReport
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExportRequest'      responses:
        '200':
          description: Export initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExportResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/financial/charts/revenue-trend:
    get:
      summary: Get revenue trend chart data
      description: |
        Retrieve time-series data for revenue trend visualization
        optimized for Shadcn chart components.
      operationId: getRevenueTrendChart
      parameters:
        - name: period
          in: query
          schema:
            type: string
            enum: [7d, 30d, 90d, 6m, 1y]
            default: 30d
      responses:
        '200':
          description: Revenue trend chart data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChartDataResponse'

  /api/financial/charts/profit-breakdown:
    get:
      summary: Get profit breakdown chart data
      description: |
        Retrieve profit breakdown by categories for pie/donut chart visualization.
      operationId: getProfitBreakdownChart
      responses:
        '200':
          description: Profit breakdown chart data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChartDataResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Supabase Auth v2.38.5 JWT token    BiometricAuth:
      type: http
      scheme: bearer
      description: WebAuthn biometric authentication for enhanced security

  schemas:
    FinancialMetricsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            totalRevenue:
              type: number
              format: decimal
              description: Total revenue in BRL
            profitMargin:
              type: number
              format: percentage
              description: Profit margin percentage
            clientLifetimeValue:
              type: number
              format: decimal
              description: Average CLV for aesthetic clinic ($2,500-$10,000)
            roomUtilization:
              type: number
              format: percentage
              description: Treatment room utilization (target 80-85%)
            conversionRate:
              type: number
              format: percentage
              description: Consultation to treatment conversion rate
            period:
              type: string
              description: Data period
        metadata:
          $ref: '#/components/schemas/ResponseMetadata'

    RevenueAnalyticsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            totalRevenue:
              type: number            breakdown:
              type: array
              items:
                type: object
                properties:
                  category:
                    type: string
                  amount:
                    type: number
                  percentage:
                    type: number
            trends:
              type: array
              items:
                type: object
                properties:
                  date:
                    type: string
                    format: date
                  value:
                    type: number

    ClinicKPIsResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            averageTicket:
              type: number
              description: Average treatment ticket value
            patientRetention:
              type: number
              format: percentage
              description: Patient retention rate
            appointmentNoShow:
              type: number
              format: percentage
              description: No-show rate
            equipmentROI:
              type: number
              format: percentage
              description: Equipment return on investment

    ExportRequest:
      type: object
      required:
        - format
        - reportType
      properties:
        format:
          type: string
          enum: [pdf, xlsx, csv]
        reportType:
          type: string
          enum: [revenue, profit, kpis, compliance]
        period:
          type: string
          enum: [monthly, quarterly, yearly]
        includeCharts:
          type: boolean
          default: true    ExportResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            exportId:
              type: string
              description: Unique export identifier
            downloadUrl:
              type: string
              format: uri
              description: Secure HTTPS download URL
            expiresAt:
              type: string
              format: date-time
              description: URL expiration timestamp

    ChartDataResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
          properties:
            chartType:
              type: string
              enum: [line, bar, pie, donut, area]
            dataset:
              type: array
              items:
                type: object
                properties:
                  label:
                    type: string
                  value:
                    type: number
                  date:
                    type: string
                    format: date
                  color:
                    type: string
                    description: Hex color for chart styling

    ResponseMetadata:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        requestId:
          type: string
        version:
          type: string
        lgpdCompliant:
          type: boolean
          description: LGPD compliance flag  responses:
    BadRequest:
      description: Invalid request parameters
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "INVALID_PARAMETERS"
                  message:
                    type: string
                    example: "Invalid date range provided"
                  details:
                    type: array
                    items:
                      type: string

    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "UNAUTHORIZED"
                  message:
                    type: string
                    example: "Valid authentication required"

    Forbidden:
      description: Insufficient permissions
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "FORBIDDEN"
                  message:
                    type: string
                    example: "Insufficient permissions for financial data access"    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "INTERNAL_ERROR"
                  message:
                    type: string
                    example: "An unexpected error occurred"
                  requestId:
                    type: string
                    example: "req_123456"