// Types for Patient Retention Analytics + Predictions// Story 7.4: Advanced patient retention analytics with predictive modeling
export type ChurnRiskLevel = 'low' | "medium" | "high" | "critical";
export type InterventionChannel =
  | 'email'
  | 'sms'
  | 'whatsapp'
  | "phone" | "in_person" | "push";
export type InterventionStatus =
  | 'planned'
  | 'scheduled'
  | 'sent'
  | 'delivered'
  | 'opened'
  | "clicked" | "responded" | "failed";

export type PatientRetentionAnalytics = {
  id: string;
  patient_id: string;
  retention_score: number;
  churn_risk_level: 'low' | "medium" | "high" | "critical";
  churn_probability: number;
  lifetime_value: number;
  predicted_ltv: number;
  retention_segment: string;
  last_visit_date: string;
  visit_frequency_score: number;
  engagement_score: number;
  satisfaction_score: number;
  financial_score: number;
  risk_factors: Array<string>;
  retention_interventions: Array<InterventionRecord>;
  calculation_date: string;
  model_version: string;
  confidence_level: number;
  created_at: string;
  updated_at: string;
};

export type RetentionMetrics = {
  total_patients: number;
  high_risk_patients: number;
  critical_risk_patients: number;
  churn_rate: number;
  retention_rate: number;
  average_ltv: number;
  predicted_ltv: number;
  average_retention_score: number;
  period_start: string;
  period_end: string;
};

export type RetentionMetricsDetailed = {
  id: string;
  clinic_id: string;
  period_start: string;
  period_end: string;
  cohort_month: string;
  total_patients: number;
  retained_patients: number;
  churned_patients: number;
  new_patients: number;
  retention_rate: number;
  churn_rate: number;
  net_retention_rate: number;
  revenue_retention_rate: number;
  patient_ltv_avg: number;
  acquisition_cost_avg: number;
  roi_score: number;
  benchmark_score: number;
  improvement_percentage: number;
  target_retention_rate: number;
  created_at: string;
  updated_at: string;
};

export type PatientChurnPrediction = {
  id: string;
  patient_id: string;
  prediction_date: string;
  churn_probability: number;
  risk_score: number;
  risk_level: 'low' | "medium" | "high" | "critical";
  predicted_churn_date: string;
  contributing_factors: Array<ChurnFactor>;
  intervention_recommendations: Array<InterventionRecommendation>;
  model_features: Record<string, number>;
  model_version: string;
  confidence_score: number;
  is_active: boolean;
  validation_status: 'pending' | 'validated' | 'disputed';
  actual_outcome: 'retained' | 'churned' | 'unknown';
  outcome_date: string;
  prediction_accuracy: number;
  created_at: string;
  updated_at: string;
};

export type RetentionIntervention = {
  id: string;
  patient_id: string;
  prediction_id: string;
  intervention_type: string;
  intervention_description: string;
  channel: 'email' | 'sms' | 'whatsapp' | "phone" | "in_person" | "push";
  personalization_data: Record<string, any>;
  trigger_conditions: Record<string, any>;
  scheduled_date: string;
  executed_date: string;
  status:
    | 'planned'
    | 'scheduled'
    | 'sent'
    | 'delivered'
    | 'opened'
    | "clicked" | "responded" | "failed";
  response_data: Record<string, any>;
  effectiveness_score: number;
  cost: number;
  roi: number;
  campaign_id: string;
  created_by: string;
  created_at: string;
  updated_at: string;
};

export type RetentionCampaignAnalytics = {
  id: string;
  campaign_id: string;
  campaign_name: string;
  campaign_type: string;
  target_segment: string;
  total_recipients: number;
  delivered_count: number;
  opened_count: number;
  clicked_count: number;
  responded_count: number;
  converted_count: number;
  delivery_rate: number;
  open_rate: number;
  click_rate: number;
  response_rate: number;
  conversion_rate: number;
  retention_improvement: number;
  cost_per_retention: number;
  roi: number;
  campaign_start_date: string;
  campaign_end_date: string;
  benchmark_comparison: Record<string, any>;
  performance_metrics: Record<string, any>;
  created_at: string;
  updated_at: string;
};

export type PatientLifetimeValue = {
  id: string;
  patient_id: string;
  calculation_date: string;
  historical_ltv: number;
  predicted_ltv: number;
  ltv_segment: string;
  average_order_value: number;
  purchase_frequency: number;
  customer_lifespan_months: number;
  retention_probability: number;
  growth_potential: number;
  acquisition_cost: number;
  ltv_to_cac_ratio: number;
  revenue_contribution: number;
  profit_margin: number;
  risk_adjusted_ltv: number;
  model_version: string;
  confidence_level: number;
  calculation_method: string;
  created_at: string;
  updated_at: string;
};

export type RetentionModelPerformance = {
  id: string;
  model_name: string;
  model_version: string;
  model_type: 'churn_prediction' | 'ltv_prediction' | 'retention_scoring';
  training_date: string;
  validation_date: string;
  accuracy_score: number;
  precision_score: number;
  recall_score: number;
  f1_score: number;
  auc_score: number;
  feature_importance: Record<string, number>;
  model_parameters: Record<string, any>;
  training_data_size: number;
  validation_data_size: number;
  cross_validation_scores: Array<number>;
  performance_trends: Record<string, any>;
  is_active: boolean;
  deployment_status: 'development' | "testing" | "production" | "deprecated";
  performance_threshold: number;
  monitoring_alerts: Array<Alert>;
  created_at: string;
  updated_at: string;
};

export type RetentionBenchmark = {
  id: string;
  industry_segment: string;
  benchmark_type:
    | 'retention_rate'
    | "churn_rate" | "ltv" | "intervention_effectiveness";
  benchmark_value: number;
  percentile_rank: number;
  data_source: string;
  sample_size: number;
  geographic_region: string;
  clinic_size_category: 'small' | "medium" | "large" | "enterprise";
  specialty_focus: string;
  benchmark_period: string;
  confidence_interval: Record<string, any>;
  metadata: Record<string, any>;
  last_updated: string;
  is_active: boolean;
  created_at: string;
};

// Supporting typesexport type ChurnFactor = {
  factor_name: string;
  factor_value: number;
  weight: number;
  category:
    | 'behavioral'
    | 'financial'
    | "clinical" | "satisfaction" | "demographic";
  description: string;
};

export type InterventionRecommendation = {
  intervention_type: string;
  priority: 'low' | "medium" | "high" | "urgent";
  expected_effectiveness: number;
  estimated_cost: number;
  channel_preference: Array<string>;
  personalization_suggestions: Record<string, any>;
  timing_recommendation: string;
  success_metrics: Array<string>;
};

export type InterventionRecord = {
  intervention_id: string;
  intervention_type: string;
  executed_date: string;
  effectiveness_score: number;
  roi: number;
  outcome: 'positive' | "neutral" | "negative" | "unknown";
};

export type Alert = {
  alert_type: string;
  severity: 'low' | "medium" | "high" | "critical";
  message: string;
  created_at: string;
  resolved: boolean;
};

// API Request/Response typesexport type RetentionAnalyticsRequest = {
  patient_id: string;
  {;
    start_date: string;
    end_date: string;
  };
  risk_levels: Array<string>;
  segments: Array<string>;
  include_predictions: boolean;
  include_interventions: boolean;
};

export type ChurnPredictionRequest = {
  patient_ids: Array<string>;
  force_recalculation: boolean;
  model_version: string;
  include_recommendations: boolean;
};

export type RetentionInterventionRequest = {
  patient_id: string;
  intervention_type: string;
  channel: string;
  personalization_data: Record<string, any>;
  scheduled_date: string;
  campaign_id: string;
};

export type RetentionMetricsRequest = {
  clinic_id: string;
  period_type: 'monthly' | 'quarterly' | 'yearly';
  start_date: string;
  end_date: string;
  include_benchmarks: boolean;
  segment_by: Array<string>;
};

export type LTVCalculationRequest = {
  patient_ids: Array<string>;
  calculation_method: 'historical' | 'predictive' | 'hybrid';
  force_recalculation: boolean;
  include_risk_adjustment: boolean;
};

export type ModelPerformanceRequest = {
  model_type: string;
  include_inactive: boolean;
  performance_threshold: number;
  include_trends: boolean;
};

// Dashboard typesexport type RetentionDashboardData = {
  {;
    total_patients: number;
    retention_rate: number;
    churn_rate: number;
    avg_ltv: number;
    improvement_percentage: number;
  };
  {;
    low: number;
    medium: number;
    high: number;
    critical: number;
  };
  recent_predictions: Array<PatientChurnPrediction>;
  active_interventions: Array<RetentionIntervention>;
  campaign_performance: Array<RetentionCampaignAnalytics>;
  {;
    segment: string;
    count: number;
    avg_ltv: number;
    retention_rate: number;
  }[];
  model_performance: Array<RetentionModelPerformance>;
  {;
    metric: string;
    our_value: number;
    benchmark_value: number;
    percentile: number;
  }[];
};

export type RetentionTrends = {
  period: string;
  retention_rate: number;
  churn_rate: number;
  ltv_avg: number;
  intervention_count: number;
  intervention_effectiveness: number;
};

export type PredictionAnalytics = {
  total_predictions: number;
  accuracy_rate: number;
  intervention_success_rate: number;
  cost_per_retention: number;
  roi: number;
  model_drift_score: number;
};

// Form typesexport type RetentionInterventionForm = {
  patient_id: string;
  intervention_type: string;
  channel: string;
  personalization_data: Record<string, any>;
  scheduled_date: string;
};

export type ModelConfigurationForm = {
  model_name: string;
  model_type: string;
  parameters: Record<string, any>;
  performance_threshold: number;
  retraining_frequency: number;
};

export type BenchmarkConfigurationForm = {
  industry_segment: string;
  benchmark_type: string;
  data_source: string;
  geographic_region: string;
  clinic_size_category: string;
};
