# üßπ **UNIVERSAL NODE_MODULES CLEANER** ‚Äî Multi-Package-Manager Optimization Expert

## üéØ OBJETIVO
**MISS√ÉO**: Analisar e otimizar **TODA** a estrutura de depend√™ncias removendo modules duplicados, redundantes, inutilizados e obsoletos (Bun + PNPM + NPM)
**QUALIDADE**: ‚â•9.5/10, **SUCESSO**: ‚â•95%
**M√âTODO**: A.P.T.E (Analyze ‚Üí Plan ‚Üí Test ‚Üí Execute) com suporte multi-package-manager

## üåê CONTEXTO UNIVERSAL
```yaml
project: "Node.js project com m√∫ltiplos package managers"
environment: "Bun | PNPM | NPM | Node.js | TypeScript"
target: "node_modules (COMPLETO) + cache folders + lock files"
scope:
  - "node_modules/.pnpm" # PNPM store
  - "node_modules" # NPM/Yarn modules
  - "node_modules/.cache" # Cache folders
  - "node_modules/.bin" # Binary links
constraints:
  - "Detectar automaticamente package manager prim√°rio"
  - "Manter depend√™ncias cr√≠ticas e funcionais"
  - "Preservar integridade do projeto"
  - "Seguir princ√≠pios KISS/YAGNI/CoT"
  - "Documentar todas as remo√ß√µes"
workflow:
  - "Detec√ß√£o de ambiente"
  - "An√°lise completa da arquitetura"
  - "Mapeamento universal de depend√™ncias"
  - "Identifica√ß√£o de redund√¢ncias"
  - "Limpeza segura e organizada"
references: "package.json | bun.lock | bun.lockb | pnpm-lock.yaml | package-lock.json"
hierarchy: "detec√ß√£o ‚Üí an√°lise ‚Üí implementa√ß√£o ‚Üí valida√ß√£o"
```

## üß† METODOLOGIA A.P.T.E

### **A - ANALYZE (Detec√ß√£o e Mapeamento)**
```yaml
objetivo: "Identificar package managers e mapear arquitetura completa"
detec√ß√£o_autom√°tica:
  bun: "Verificar exist√™ncia de bun.lock ou bun.lockb e bin√°rio bun"
  pnpm: "Verificar exist√™ncia de pnpm-lock.yaml"
  npm: "Verificar exist√™ncia de package-lock.json"
  primary_manager: "Determinar gerenciador principal por prioridade: Bun ‚Üí PNPM ‚Üí NPM"
mapeamento_estrutura:
  - "Ler e analisar package.json (universal)"
  - "Analisar todos os lock files presentes"
  - "Escanear imports/requires no c√≥digo fonte"
  - "Mapear depend√™ncias dev vs produ√ß√£o vs peer"
  - "Identificar scripts que usam packages"
  - "Documentar estrutura completa de node_modules"
valida√ß√£o: "Mapeamento completo ‚â•9.5/10 de precis√£o"
```

### **P - PLAN (Estrat√©gia Universal)**
```yaml
objetivo: "Criar estrat√©gia detalhada de otimiza√ß√£o multi-manager"
backup_obrigat√≥rio:
  - "package.json ‚Üí backup-dependencies/"
  - "bun.lock | bun.lockb ‚Üí backup-dependencies/ (se existe)"
  - "pnpm-lock.yaml ‚Üí backup-dependencies/ (se existe)"
  - "package-lock.json ‚Üí backup-dependencies/ (se existe)"
  - "node_modules ‚Üí node_modules.backup_[timestamp] (opcional se muito grande)"
sequ√™ncia_por_manager:
  bun: "pm cache rm (opcional) ‚Üí rm -rf node_modules (quando necess√°rio) ‚Üí install --frozen-lockfile --ignore-scripts --filter '*' ‚Üí rebuild nativo via scripts (esbuild/sharp/prisma)"
  pnpm: "store prune ‚Üí prune (root + -r) ‚Üí dedupe (root + -r) ‚Üí install --frozen-lockfile --prefer-offline --ignore-scripts ‚Üí rebuild"
  npm: "cache verify|clean ‚Üí rm node_modules ‚Üí ci --ignore-scripts ‚Üí audit (informativo)"
valida√ß√£o_planejada: "Build + type-check (root e workspaces) e prisma generate"
notas:
  - "Evitar misturar gerenciadores; seguir packageManager do root"
  - "Preferir bun workspaces com --filter ou pnpm -r para opera√ß√µes em monorepo"
```


### **T - TEST (Valida√ß√£o Cont√≠nua)**
```yaml
objetivo: "Validar cada etapa sem quebrar funcionalidades"
pr√©_valida√ß√£o:
  - "Verificar se package managers est√£o dispon√≠veis"
  - "Confirmar diret√≥rio correto"
  - "Testar comandos b√°sicos"
p√≥s_comando:
  - "Verificar exit codes"
  - "Monitorar outputs para warnings/errors"
  - "Confirmar arquivos cr√≠ticos existem"
valida√ß√£o_final:
  - "Build deve executar sem erros"
  - "Testes devem passar (se dispon√≠veis)"
  - "Estrutura do projeto intacta"
```

### **E - EXECUTE (Implementa√ß√£o Segura)**
```yaml
objetivo: "Executar limpeza preservando funcionalidades cr√≠ticas"
logging_detalhado:
  - "Timestamp de cada opera√ß√£o"
  - "Output completo de comandos"
  - "M√©tricas antes/depois"
tratamento_erros:
  - "Parar em caso de falhas cr√≠ticas"
  - "Rollback autom√°tico se necess√°rio"
  - "Documentar problemas encontrados"
relat√≥rio_final:
  - "M√©tricas de otimiza√ß√£o"
  - "Lista de problemas resolvidos"
  - "Recomenda√ß√µes futuras"
```

## üìã FASES DE EXECU√á√ÉO UNIVERSAL

### **FASE 0: DETEC√á√ÉO DE AMBIENTE**
```bash
# Comandos de detec√ß√£o autom√°tica (Monorepo-aware)
echo "üîç Detectando package manager e monorepo..."

# Detecta lockfiles e workspaces
[[ -f bun.lock || -f bun.lockb ]] && echo "‚úÖ Bun lockfile detectado" || echo "‚ùå Bun lockfile n√£o encontrado"
[[ -f pnpm-lock.yaml ]] && echo "‚úÖ PNPM lockfile detectado" || echo "‚ùå PNPM lockfile n√£o encontrado"
[[ -f package-lock.json ]] && echo "‚úÖ NPM lockfile detectado" || echo "‚ùå NPM lockfile n√£o encontrado"
[[ -f pnpm-workspace.yaml ]] && echo "‚úÖ Monorepo PNPM detectado (pnpm-workspace.yaml)" || echo "‚ÑπÔ∏è pnpm-workspace.yaml n√£o encontrado"

# Verifica manager configurado em package.json (detec√ß√£o robusta via jq)
pm_val=$(jq -r '.packageManager // ""' package.json 2>/dev/null || echo "")
if echo "$pm_val" | grep -q '^bun@'; then
  echo "‚úÖ packageManager=bun configurado (preferir Bun)"
elif echo "$pm_val" | grep -q '^pnpm@'; then
  echo "‚úÖ packageManager=pnpm configurado (fallback PNPM)"
fi

# Verificar ferramentas instaladas
which bun >/dev/null 2>&1 && bun -v || echo "‚ÑπÔ∏è bun n√£o encontrado no PATH"
which pnpm >/dev/null 2>&1 && pnpm -v || echo "‚ÑπÔ∏è pnpm n√£o encontrado no PATH"
which npm >/dev/null 2>&1 && npm -v || true
node -v && echo "Node.js OK"

# Checagem de mistura perigosa de lockfiles
if ([[ -f bun.lock || -f bun.lockb ]] && ([[ -f pnpm-lock.yaml ]] || [[ -f package-lock.json ]])); then
  echo "‚ö†Ô∏è M√∫ltiplos lockfiles detectados (bun + outros). Evite misturar gerenciadores."
fi

# Medir estado inicial (monorepo root)
echo "üìä Estado inicial do root:"
[[ -d node_modules ]] && du -sh node_modules || echo "(sem node_modules no root)"

# M√©tricas caches comuns
[[ -d .turbo ]] && du -sh .turbo || true
find apps -maxdepth 2 -type d -name cache -path '*/.next/cache' -exec du -sh {} + 2>/dev/null || true
```


### **FASE 1: AN√ÅLISE ARQUITETURAL UNIVERSAL**
```bash
# Mapeamento completo de depend√™ncias (root + workspaces)
echo "üìã Analisando depend√™ncias..."

# Para PNPM (se detectado)
if [[ -f pnpm-lock.yaml ]]; then
  echo "üîç An√°lise PNPM (root):"
  pnpm list --depth=0 > deps_pnpm_root.txt
  pnpm outdated > outdated_pnpm_root.txt 2>/dev/null || true
  pnpm audit --json > audit_pnpm_root.json 2>/dev/null || true

  echo "üîç An√°lise PNPM (workspaces):"
  pnpm -r list --depth=0 > deps_pnpm_workspaces.txt
  pnpm -r outdated > outdated_pnpm_workspaces.txt 2>/dev/null || true
fi

# Para NPM (se detectado)
if [[ -f package-lock.json ]]; then
  echo "üîç An√°lise NPM:"
  npm ls --depth=0 > deps_npm.txt 2>/dev/null || true
  npm outdated > outdated_npm.txt 2>/dev/null || true
  npm audit --json > audit_npm.json 2>/dev/null || true
fi

# Para Bun (se detectado)
if [[ -f bun.lock || -f bun.lockb ]]; then
  echo "üîç An√°lise Bun:"
  bun pm ls --depth=0 > deps_bun_root.txt 2>/dev/null || true
  bun outdated > outdated_bun_root.txt 2>/dev/null || true
  bun audit > audit_bun_root.txt 2>/dev/null || true
fi

# An√°lise de uso real no c√≥digo (ignora caches e build outputs)
echo "üîé Mapeando uso real de depend√™ncias..."
grep -r "import\|require" \
  --include="*.{js,ts,tsx,jsx}" \
  --exclude-dir=node_modules \
  --exclude-dir=.next \
  --exclude-dir=dist \
  --exclude-dir=.turbo \
  . > used_deps.txt 2>/dev/null || true
```


### **FASE 2: BACKUP E SEGURAN√áA UNIVERSAL**
```bash
# Backup completo obrigat√≥rio
echo "üíæ Criando backup completo..."
mkdir -p backup-dependencies

# Backup de lock files
timestamp=$(date +%Y%m%d_%H%M%S)
cp package.json "backup-dependencies/package.json.backup-$timestamp"
[[ -f pnpm-lock.yaml ]] && cp pnpm-lock.yaml "backup-dependencies/pnpm-lock.yaml.backup-$timestamp"
[[ -f package-lock.json ]] && cp package-lock.json "backup-dependencies/package-lock.json.backup-$timestamp"
[[ -f yarn.lock ]] && cp yarn.lock "backup-dependencies/yarn.lock.backup-$timestamp"

### **FASE 3: OTIMIZA√á√ÉO SISTEM√ÅTICA UNIVERSAL**
```bash
# Estrat√©gia Bun (preferencial neste monorepo)
if [[ -f bun.lock || -f bun.lockb ]]; then
  echo "üßπ Executando limpeza Bun (workspaces)..."

  echo "  1/6 (Opcional) Limpar cache global do Bun"
  bun pm cache rm || true

  echo "  2/6 Removendo caches locais e node_modules quando necess√°rio"
  rm -rf node_modules 2>/dev/null || true

  echo "  3/6 Reinstalando com lockfile congelado (monorepo-aware)"
  bun install --frozen-lockfile --ignore-scripts --filter '*'

  echo "  4/6 Regenerar Prisma e rebuild nativos se necess√°rio"
  (bun run --filter '*' prisma:generate || (bunx prisma --version >/dev/null 2>&1 && bunx prisma generate)) || true

  echo "  5/6 (Opcional) Outdated/Audit informativos"
  bun outdated || true
  bun audit || true

  echo "  6/6 Turbo prune/build (se aplic√°vel)"
  (bunx turbo prune --scope="apps/*" --docker || true)
  (bunx turbo run build --filter='...' || true)

  echo "‚úÖ Otimiza√ß√£o Bun conclu√≠da"
fi

# Estrat√©gia PNPM (fallback) 
if [[ -f pnpm-lock.yaml && ! -f bun.lock && ! -f bun.lockb ]]; then
  echo "üßπ Executando limpeza PNPM (root + workspaces)..."

  echo "  1/6 Limpando store global..."
  pnpm store prune

  echo "  2/6 Prune de depend√™ncias n√£o referenciadas (root + workspaces)..."
  pnpm prune || true
  pnpm -r prune || true

  echo "  3/6 Deduplicando vers√µes (root + workspaces)..."
  pnpm dedupe || true
  pnpm -r dedupe || true

  echo "  4/6 Reinstalando depend√™ncias (modo seguro CI)..."
  pnpm install --frozen-lockfile --prefer-offline --ignore-scripts

  echo "  5/6 Rebuild de bin√°rios nativos quando necess√°rio (esbuild/sharp/prisma)..."
  pnpm rebuild || true

  echo "  6/6 Auditoria (informativa)"
  pnpm audit --json > audit_pnpm_post.json 2>/dev/null || true

  echo "‚úÖ Otimiza√ß√£o PNPM conclu√≠da"
fi

# Estrat√©gia NPM (se e somente se pnpm n√£o for detectado)
if [[ -f package-lock.json && ! -f pnpm-lock.yaml ]]; then
  echo "üßπ Executando limpeza NPM..."
  echo "  1/4 Limpando cache..."
  npm cache verify || npm cache clean --force
  
  echo "  2/4 Removendo node_modules..."
  rm -rf node_modules
  
  echo "  3/4 Reinstalando com npm ci..."
  npm ci --ignore-scripts
  
  echo "  4/4 Auditoria (informativa)"
  npm audit --json > audit_npm_post.json 2>/dev/null || true
  
  echo "‚úÖ Otimiza√ß√£o NPM conclu√≠da"
fi

# Estrat√©gia NPM (fallback final)
if [[ -f package-lock.json && ! -f bun.lock && ! -f bun.lockb && ! -f pnpm-lock.yaml ]]; then
  echo "üßπ Executando limpeza NPM..."
  echo "  1/4 Limpando cache..."
  npm cache verify || npm cache clean --force
  
  echo "  2/4 Removendo node_modules..."
  rm -rf node_modules
  
  echo "  3/4 Reinstalando com npm ci..."
  npm ci --ignore-scripts

  echo "  4/4 Auditoria (informativa)"
  npm audit --json > audit_npm_post.json 2>/dev/null || true
  
  echo "‚úÖ Otimiza√ß√£o NPM conclu√≠da"
fi
```

### **FASE 4: LIMPEZA UNIVERSAL FINAL**
```bash
# Limpeza de cache e arquivos tempor√°rios (inclui Next.js/Turbo/Playwright)
echo "üóëÔ∏è Limpeza universal de cache e tempor√°rios..."

# Remover caches dentro de node_modules (geralmente seguros)
find node_modules -name ".cache" -type d -prune -exec rm -rf {} + 2>/dev/null || true
find node_modules -name "*.tmp" -type f -delete 2>/dev/null || true
find node_modules -name "*.log" -type f -delete 2>/dev/null || true
find node_modules -name ".DS_Store" -type f -delete 2>/dev/null || true

# Next.js caches (apps/*/ .next/cache)
find apps -maxdepth 2 -type d -name cache -path '*/.next/cache' -exec rm -rf {} + 2>/dev/null || true

# Turborepo cache (root)
[[ -d .turbo ]] && rm -rf .turbo || true

# Playwright browsers cache (opcional: limpa bin√°rios baixados)
if command -v bunx >/dev/null 2>&1; then
  bunx playwright install --with-deps 2>/dev/null || true
elif command -v npx >/dev/null 2>&1; then
  npx --yes playwright install --with-deps 2>/dev/null || true
fi

# Limpar symlinks quebrados
find node_modules/.bin -type l ! -exec test -e {} \; -delete 2>/dev/null || true

echo "üßπ Limpeza universal conclu√≠da"
```


### **FASE 4B: HEAVY CLEAN (OPCIONAL E DESTRUTIVO)**

Aviso: use apenas se a limpeza padr√£o n√£o resolveu problemas. Ir√° remover m√≥dulos e caches reconstru√≠veis.

```bash
read -p "Confirma HEAVY CLEAN? (y/N) " ans; [[ "$ans" == "y" || "$ans" == "Y" ]] || { echo "Cancelado."; exit 0; }

# Remover m√≥dulos e caches reconstru√≠veis
rm -rf node_modules .turbo
find apps -maxdepth 2 -type d -name cache -path '*/.next/cache' -exec rm -rf {} + 2>/dev/null || true

# Pr√©-aquecer e reinstalar determin√≠stico (Bun como prim√°rio)
(bun install --lockfile-only || true)
(bun install --frozen-lockfile --ignore-scripts --filter '*')

# Regenerar Prisma e rebuild nativos se necess√°rio
(bun run --filter '*' prisma:generate || (bunx prisma --version >/dev/null 2>&1 && bunx prisma generate)) || true
(bun run --filter '*' rebuild || true)
```

### **FASE 5: VALIDA√á√ÉO FINAL UNIVERSAL**
```bash
# Valida√ß√£o completa p√≥s-otimiza√ß√£o
echo "‚úÖ Executando valida√ß√£o final..."

# Preferir tasks do monorepo quando dispon√≠veis (PNPM workspaces)
if command -v bun >/dev/null && ([[ -f bun.lock ]] || [[ -f bun.lockb ]]); then
  # Prisma: regenerar clientes (evita erros de engine em Next/Hono)
  (bun run --filter '*' prisma:generate || (bunx prisma --version >/dev/null 2>&1 && bunx prisma generate)) || true

  # Builds dos workspaces (prefer Turbo)
  echo "üõ† Testando build dos workspaces..."
  (bunx turbo run build --filter='...' || bun --filter '*' run build || true)

  # Type-check nos workspaces
  echo "üîç Verificando types no monorepo..."
  (bun --filter '*' run type-check || true)

elif command -v pnpm >/dev/null && [[ -f pnpm-lock.yaml ]]; then
  # Prisma: regenerar clientes
  (pnpm -r exec prisma --version >/dev/null 2>&1 && pnpm -r prisma generate) || true
  echo "üõ† Testando build dos workspaces..."
  pnpm -r run build || echo "‚ö†Ô∏è Algumas builds falharam"
  echo "üîç Verificando types no monorepo..."
  pnpm -r run type-check || echo "‚ö†Ô∏è Alguns type-checks falharam"
else
  # Fallback por package.json no root
  if [[ -f package.json ]]; then
    if grep -q '"build"' package.json; then
      echo "üõ† Testando build..."
      npm run build || true
    fi
    if grep -q '"type-check"' package.json; then
      echo "üîç Verificando tipos..."
      npm run type-check || true
    fi
  fi
fi

# M√©tricas finais
echo "üìä M√©tricas finais:"
[[ -d node_modules ]] && du -sh node_modules || echo "(sem node_modules no root)"

echo "‚úÖ Valida√ß√£o final conclu√≠da"
```


## üîí SALVAGUARDAS CR√çTICAS

### üö´ NUNCA FA√áA
- ‚ùå Executar limpeza sem backup completo
- ‚ùå Ignorar falhas no type-check ou build
- ‚ùå Remover depend√™ncias sem verificar uso real
- ‚ùå Pular valida√ß√£o p√≥s-limpeza
- ‚ùå Executar em produ√ß√£o sem testes em desenvolvimento
- ‚ùå Remover arquivos de lock sem backup

### ‚úÖ SEMPRE FA√áA
- ‚úÖ Backup completo antes de qualquer altera√ß√£o
- ‚úÖ Detectar package manager automaticamente
- ‚úÖ Medir m√©tricas antes e depois
- ‚úÖ Validar cada etapa individualmente
- ‚úÖ Documentar todos os problemas encontrados
- ‚úÖ Manter arquivos de rollback dispon√≠veis
- ‚úÖ Testar funcionalidades cr√≠ticas ap√≥s limpeza

### üõ°Ô∏è SAFETY FIRST
- Verificar exit codes de todos os comandos
- Parar execu√ß√£o em caso de erros cr√≠ticos
- Documentar procedimento de recupera√ß√£o
- Validar integridade dos lock files
- Preservar configura√ß√µes espec√≠ficas (.npmrc, .yarnrc, etc.)

## üìä M√âTRICAS DE QUALIDADE

### KPIs de Sucesso Universal
- **Redu√ß√£o de tamanho**: Meta ‚â•40% do node_modules
- **Arquivos removidos**: Meta ‚â•1000 arquivos desnecess√°rios
- **Duplicatas resolvidas**: Meta 100% das duplicatas identificadas
- **Funcionalidade**: Zero breakage (build + type-check OK)
- **Cache otimizado**: Limpeza completa de todos os caches
- **Vulnerabilidades**: Resolu√ß√£o de issues cr√≠ticas e altas

### Formato de Relat√≥rio
```markdown
## üìä RESULTADOS DA LIMPEZA UNIVERSAL

| Package Manager | Detectado | Otimizado |
|----------------|-----------|-----------|
| Bun            | ‚úÖ/‚ùå     | ‚úÖ/‚ùå     |
| PNPM           | ‚úÖ/‚ùå     | ‚úÖ/‚ùå     |
| NPM            | ‚úÖ/‚ùå     | ‚úÖ/‚ùå     |

| M√©trica               | ANTES     | DEPOIS    | ECONOMIA              |
|-----------------------|-----------|-----------|----------------------|
| Tamanho node_modules  | X.XX GB   | X.XX GB   | X.XX GB (X.X%)       |
| Arquivos totais       | XXX,XXX   | XXX,XXX   | X,XXX arquivos       |
| Packages instalados   | XXX       | XXX       | XX packages          |
| Vulnerabilidades      | XX        | XX        | XX corrigidas        |

## ‚úÖ VALIDA√á√ïES EXECUTADAS

- [x] Backup criado e validado
- [x] Package manager detectado automaticamente
- [x] Build executado sem erros
- [x] Type-check passou (se dispon√≠vel)
- [x] Estrutura do projeto preservada
- [x] Cache limpo universalmente
- [x] Vulnerabilidades corrigidas
- [x] Performance melhorada

## üîÑ ROLLBACK DISPON√çVEL

```bash
# Para restaurar backup:
cp backup-dependencies/package.json.backup-* package.json
cp backup-dependencies/*-lock*.backup-* .
rm -rf node_modules
# Execute install do package manager detectado
```
```

## üöÄ COMANDOS R√ÅPIDOS PARA GITHUB COPILOT

### üéØ Comando B√°sico
```
@copilot Execute limpeza universal de depend√™ncias:
1. Detectar package managers (Bun/PNPM/NPM)
2. Backup completo (package.json + lock files)
3. Medir tamanho atual node_modules
4. Executar otimiza√ß√£o espec√≠fica do manager detectado
5. Validar com build/type-check
6. Relat√≥rio com m√©tricas antes/depois

Meta: ‚â•40% redu√ß√£o, zero breakage, suporte universal
```

### üîç Comando Completo A.P.T.E
```
@copilot Seguindo metodologia A.P.T.E, execute limpeza UNIVERSAL de depend√™ncias:

**ANALYZE:**
- Detectar automaticamente Bun/PNPM/NPM
- Mapear package.json e todos os lock files
- Medir tamanho/arquivos de node_modules
- Identificar depend√™ncias n√£o utilizadas no c√≥digo
- Verificar audit para vulnerabilidades

**PLAN:**
- Backup universal: package.json + lock files + node_modules
- Estrat√©gia espec√≠fica por package manager detectado
- Sequ√™ncia otimizada: prune ‚Üí cache clean ‚Üí reinstall ‚Üí audit fix

**TEST:**
- Validar exit codes de cada comando
- Executar build e type-check (se dispon√≠veis)
- Verificar estrutura do projeto intacta

**EXECUTE:**
- Logging detalhado de cada opera√ß√£o
- M√©tricas antes/depois universais
- Relat√≥rio final com economia alcan√ßada e package manager usado

**SAFETY:** Backup obrigat√≥rio, detec√ß√£o autom√°tica, rollback dispon√≠vel, zero toler√¢ncia a quebras
```

### üìä Comando de An√°lise Somente
```
@copilot Analise depend√™ncias do projeto:
1. Detectar package managers ativos (PNPM/NPM/Yarn)
2. Listar deps/devDeps do package.json
3. Medir tamanho atual do node_modules
4. Identificar depend√™ncias depreciadas (audit universal)
5. Mapear uso real de imports/requires no c√≥digo
6. Relat√≥rio com oportunidades de otimiza√ß√£o

N√ÉO execute limpeza, apenas an√°lise e detec√ß√£o.
```

### üîÑ Comando de Rollback Universal
```
@copilot Execute rollback da limpeza de depend√™ncias:
1. Detectar package manager usado originalmente
2. Restaurar backup-dependencies/*.backup-*
3. Executar install com frozen lockfile
4. Validar com build/type-check
5. Confirmar funcionalidade restaurada

Restaurar estado exato anterior √† limpeza.
```

### üè• Comando Espec√≠fico NEONPRO Healthcare
```
@copilot Execute limpeza de depend√™ncias para projeto healthcare NEONPRO:

**CONTEXTO HEALTHCARE/MONOREPO:**
- packageManager=bun ou pnpm no root; usar Bun como padr√£o e PNPM como fallback
- Turborepo e Next.js 15: limpar .turbo e .next/cache de apps/*
- Playwright: n√£o remover browsers baixados salvo necessidade; reinstalar com `playwright install --with-deps` se limpar
- Prisma: executar `pnpm -r prisma generate` ap√≥s reinstala√ß√£o
- Evitar misturar managers; respeitar pnpm-lock.yaml

**EXECU√á√ÉO SEGURA:**
- Backup completo antes de qualquer modifica√ß√£o
- A.P.T.E com foco em zero downtime
- Bun: install --frozen-lockfile --ignore-scripts --filter '*' ‚Üí prisma generate ‚Üí bunx turbo run build
- PNPM: store prune ‚Üí prune (-r) ‚Üí dedupe (-r) ‚Üí install --frozen-lockfile --prefer-offline --ignore-scripts ‚Üí rebuild
- Relat√≥rio final com m√©tricas healthcare

Meta: ‚â•40% redu√ß√£o mantendo compliance 100% e builds verdes
```

---

## üéØ COMO USAR

1. **Copiar** um dos comandos acima
2. **Colar** no GitHub Copilot Chat
3. **Aguardar** execu√ß√£o autom√°tica com detec√ß√£o de package manager
4. **Revisar** relat√≥rio gerado com m√©tricas universais
5. **Validar** funcionamento do projeto
6. **Manter** backup para rollback se necess√°rio

---

## üèóÔ∏è CI/CD RECIPES (BUN-FIRST, TURBO)

```bash
# Setup bun
bun --version

# Deterministic install
bun install --frozen-lockfile --ignore-scripts --filter '*'

# Turbo cache-aware build
bunx turbo run type-check --filter='...'
bunx turbo run build --filter='...'

# Tests (vitest/playwright via bunx)
bunx vitest run --reporter=verbose
bunx vitest run --project integration --reporter=verbose || true
bunx playwright test || true

# Playwright no CI
bunx playwright install --with-deps || true

# Fallbacks
pnpm install --frozen-lockfile --prefer-offline --ignore-scripts || true
npm ci --ignore-scripts || true
```

### ‚ÑπÔ∏è Nota sobre Bun √ó PNPM √ó NPM
- Preferir Bun como package manager e executor (bun, bunx, bun.lock ou bun.lockb).
- Se um pacote n√£o funcionar com Bun, usar PNPM como fallback (pnpm-lock.yaml presente).
- Em √∫ltimo caso, usar NPM (package-lock.json) apenas quando o pacote n√£o aceitar Bun nem PNPM.
- Evitar m√∫ltiplos lockfiles. N√£o use Yarn neste reposit√≥rio.

## üîÑ MANUTEN√á√ÉO E CUSTOMIZA√á√ÉO

### Versioning
- v1.2.0 - Bun-first monorepo update (Set 2025)
  - Detec√ß√£o monorepo/manager aprimorada
  - Fluxo PNPM workspace-aware (prune/dedupe/install/rebuild)
  - Limpeza de caches Next/Turbo/Playwright
  - Valida√ß√£o com prisma generate + builds -r
  - Se√ß√£o HEAVY CLEAN opcional
  - Receitas CI/CD e nota Bun√óPNPM
- v1.0.0 - Vers√£o inicial universal (Ago 2025)
- Compat√≠vel com PNPM, NPM e Yarn
- Atualizar conforme novos package managers

### Adapta√ß√£o por Projeto
Para personalizar:
1. Ajustar depend√™ncias cr√≠ticas na se√ß√£o de salvaguardas
2. Modificar comandos de valida√ß√£o espec√≠ficos
3. Adaptar m√©tricas de sucesso conforme necessidade
4. Personalizar estrutura de backup

---

_Prompt universal criado para otimiza√ß√£o de depend√™ncias em qualquer projeto Node.js com suporte multi-package-manager_
